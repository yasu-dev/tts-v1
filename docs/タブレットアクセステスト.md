# タブレットアクセステスト手順

## 🎯 テスト目的

タブレットからトリアージ入力画面にアクセスし、実際の運用を想定した動作確認を行います。

---

## 📱 テスト環境

### 推奨タブレット
- **iPad** (iOS 14以上)
- **Androidタブレット** (Android 10以上)
- **Windowsタブレット** (Windows 10/11)

### 推奨ブラウザ
- **Safari** (iOS/iPadOS)
- **Chrome** (Android/Windows)
- **Edge** (Windows)

---

## ✅ テスト項目チェックリスト

### 1. 基本アクセス

- [ ] **Netlify URLにアクセス**
  - URL: `https://your-site-name.netlify.app`
  - HTTPSであることを確認（鍵マークが表示される）

- [ ] **ログイン画面が表示される**
  - レイアウトが崩れていない
  - 入力フィールドが正しく表示される

---

### 2. ログイン機能

#### トリアージ担当者でログイン

```
Email: tri@demo.com
Password: password
```

- [ ] ログインボタンが押せる
- [ ] ログイン後、トリアージ入力画面（`/triage/scan`）にリダイレクトされる
- [ ] エラーメッセージが表示されない

---

### 3. トリアージ入力画面の表示

- [ ] **ヘッダー表示**
  - 「トリアージ入力」タイトルが表示される
  - ログアウトボタンが表示される

- [ ] **QRスキャンエリア**
  - QRスキャナー領域が表示される
  - 「手動入力」ボタンが表示される

- [ ] **レイアウト確認**
  - タブレットの画面サイズに合っている
  - スクロールが正常に機能する
  - ボタンが押しやすいサイズ

---

### 4. カメラ機能（QRスキャン）

#### 初回アクセス時

- [ ] **カメラ許可のダイアログが表示される**
  - 「カメラへのアクセスを許可しますか？」
  - 「許可」をタップ

#### カメラ起動確認

- [ ] カメラプレビューが表示される
- [ ] リアルタイムで映像が表示される
- [ ] QRコードをかざすと読み取る（テスト用QRコードがあれば）

#### カメラ許可しなかった場合

- [ ] 「手動入力」ボタンが使える
- [ ] カメラエラーメッセージが表示される（適切に）

---

### 5. 位置情報機能

#### 初回アクセス時

- [ ] **位置情報許可のダイアログが表示される**
  - 「位置情報へのアクセスを許可しますか？」
  - 「許可」をタップ

#### 位置情報取得確認

- [ ] 位置情報が自動で取得される
- [ ] 緯度・経度が表示される（デバッグ情報がある場合）
- [ ] エラーなく動作する

#### 位置情報許可しなかった場合

- [ ] 手動で位置情報を入力できる
- [ ] または、デフォルト位置が使用される

---

### 6. 患者情報入力

#### 手動入力モード

- [ ] **基本情報入力**
  - 年齢入力フィールド
  - 性別選択（男性/女性/その他）
  - タップで選択できる

- [ ] **バイタルサイン入力**
  - 呼吸数
  - 心拍数
  - SpO2
  - 血圧
  - 体温
  - 意識レベル

- [ ] **入力のしやすさ**
  - 数値キーボードが表示される
  - タップ操作がスムーズ
  - 画面が見やすい

---

### 7. START法トリアージ

- [ ] **質問が順次表示される**
  1. 歩行可能か？
  2. 呼吸の状態
  3. 循環の状態
  4. 意識の状態

- [ ] **選択肢をタップできる**
  - はい/いいえボタン
  - ボタンのサイズが適切

- [ ] **トリアージ結果が表示される**
  - 黒/赤/黄/緑のいずれか
  - 色分けされて見やすい
  - 判定理由が表示される

---

### 8. 患者登録

- [ ] **登録ボタンが押せる**
  - ボタンが有効化される
  - タップでローディング表示

- [ ] **登録完了メッセージ**
  - 「登録しました」などの確認メッセージ
  - エラーがない

- [ ] **データ送信確認**
  - Supabaseに正常に保存される
  - ネットワークエラーがない

---

### 9. リアルタイム同期確認

#### PCで指揮本部ダッシュボードを開く

```
URL: https://your-site-name.netlify.app/command
Email: ic@demo.com
Password: password
```

#### タブレットで患者を登録

- [ ] **PCの指揮本部に即座に反映される**
  - 統計カードが更新される（総数+1）
  - トリアージタグ一覧に追加される
  - 地図上にマーカーが表示される
  - 「データ更新」バッジが表示される

- [ ] **リアルタイム更新の速度**
  - 数秒以内に反映される
  - 遅延が少ない

---

### 10. パフォーマンス確認

- [ ] **ページ読み込み速度**
  - 初回: 3秒以内
  - 2回目以降: 1秒以内

- [ ] **操作のレスポンス**
  - ボタンタップ: 即座に反応
  - 入力フィールド: スムーズ
  - カメラ起動: 2秒以内

- [ ] **バッテリー消費**
  - 異常な発熱がない
  - バッテリー消費が激しくない

---

### 11. オフライン動作（将来的）

- [ ] **ネットワーク切断時**
  - エラーメッセージが表示される
  - ローカルに一時保存される（実装されていれば）
  - オンライン復帰時に自動送信される

---

### 12. セキュリティ確認

- [ ] **HTTPS接続**
  - アドレスバーに鍵マークが表示される
  - 証明書が有効

- [ ] **セッション管理**
  - ログアウトボタンが機能する
  - 再ログインが必要になる
  - セッションタイムアウトが適切

---

## 🐛 トラブルシューティング

### カメラが起動しない

**症状:**
- カメラプレビューが表示されない
- 黒い画面のまま

**解決方法:**
1. ブラウザの設定でカメラ許可を確認
2. デバイスの設定でブラウザにカメラ権限を付与
3. 別のブラウザで試す
4. タブレットを再起動

**確認コマンド（デベロッパーツール）:**
```javascript
navigator.mediaDevices.getUserMedia({ video: true })
  .then(() => console.log("Camera OK"))
  .catch(err => console.error("Camera Error:", err))
```

---

### 位置情報が取得できない

**症状:**
- 位置情報エラーが表示される
- 緯度経度が0.0になる

**解決方法:**
1. デバイスの位置情報サービスをONにする
2. ブラウザの設定で位置情報許可を確認
3. HTTPSであることを確認（HTTPでは位置情報が使えない）
4. 屋外で試す（GPS信号が弱い場合）

**確認コマンド（デベロッパーツール）:**
```javascript
navigator.geolocation.getCurrentPosition(
  pos => console.log("Location:", pos.coords),
  err => console.error("Location Error:", err)
)
```

---

### 画面が崩れる

**症状:**
- レイアウトがおかしい
- ボタンが見切れる
- 文字が小さすぎる/大きすぎる

**解決方法:**
1. ブラウザのキャッシュをクリア
2. ページをリロード（引っ張って更新）
3. タブレットの表示設定を確認
4. 別のブラウザで試す

---

### ログインできない

**症状:**
- 「ログイン失敗」エラー
- 無限ローディング

**解決方法:**
1. メールアドレスとパスワードを再確認
2. ネットワーク接続を確認
3. Supabaseの稼働状況を確認
4. Netlify環境変数が正しく設定されているか確認

**デモアカウント再確認:**
```
トリアージ担当: tri@demo.com / password
指揮本部: ic@demo.com / password
搬送管理: trn@demo.com / password
医療機関: hsp@demo.com / password
```

---

### データが送信されない

**症状:**
- 登録ボタンを押してもエラー
- 指揮本部に反映されない

**解決方法:**
1. ネットワーク接続を確認
2. ブラウザのコンソールでエラー確認
3. Supabase RLSポリシーを確認
4. デモユーザーが正しく作成されているか確認

---

## 📊 テスト結果記録表

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| 基本アクセス | ☐ OK / ☐ NG | |
| ログイン機能 | ☐ OK / ☐ NG | |
| トリアージ画面表示 | ☐ OK / ☐ NG | |
| カメラ機能 | ☐ OK / ☐ NG | |
| 位置情報機能 | ☐ OK / ☐ NG | |
| 患者情報入力 | ☐ OK / ☐ NG | |
| START法トリアージ | ☐ OK / ☐ NG | |
| 患者登録 | ☐ OK / ☐ NG | |
| リアルタイム同期 | ☐ OK / ☐ NG | |
| パフォーマンス | ☐ OK / ☐ NG | |

---

## 🎉 テスト完了後

### 全てOKの場合

✅ **本番運用準備完了！**

次のステップ:
1. デモデータの投入
2. 実際のトリアージフローテスト
3. ユーザートレーニング
4. 運用開始

### 問題がある場合

❌ **問題を報告**

1. テスト結果記録表を確認
2. エラーログを保存（スクリーンショット）
3. ブラウザのコンソールログを保存
4. GitHubにIssueを作成

---

## 📚 関連ドキュメント

- [Netlifyデプロイ手順.md](./Netlifyデプロイ手順.md)
- [TROUBLESHOOTING.md](../TROUBLESHOOTING.md)
- [LOGOUT_GUIDE.md](./LOGOUT_GUIDE.md)

---

作成日: 2025-10-18
