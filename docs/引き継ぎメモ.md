本番移行
- AWS環境へ移行（開発環境）
  - 現状のリポジトリには AWS 向けの IaC/デプロイ設定は存在しません。`netlify.toml` はありますが、AWS 用の定義は未整備です。デプロイ先決定後に環境変数セット、ビルド/起動スクリプト、ヘルスチェック、監視（Sentry/Datadog は `config/environments/production.ts` にキー定義あり）を実装する必要あり。
- DB移行（SQLite→Supabase）
  - Prisma の `datasource db` は `sqlite` 固定（`prisma/schema.prisma`）。Supabase(PostgreSQL)へ移行するには:
    - `schema.prisma` の `provider: postgresql` と `DATABASE_URL` を切替
    - 既存多数の API が各所で `new PrismaClient()` を生成（例: `app/api/**/route.ts`）。PostgreSQL では接続プール考慮が必要のため、`lib/database.ts` の共有クライアントへ統一するリファクタが必須
    - 本番向け `config/environments/production.ts` は Postgres 前提だが、スキーマ側が SQLite のままという差異があるため、移行計画に「スキーマ切替+移行（migrate）」を明記すべき
  - 「ユーザー／商品データの移行は不要」との記述は要注意。認証実装はDBユーザー・セッション前提（`lib/auth.ts`）。本番でも最低限の管理者/スタッフ/セラーの初期ユーザー、マスタデータは必要。`prisma/seed-master-data.ts` でマスタを、`prisma/seed-with-images.ts` で初期ユーザー作成が可能。移行対象から外す場合は、種別ごとの初期シード方針を明示すること。
  - 画像・ラベル等のローカルFS依存（`uploads/` や `fs.*`）は S3 へ移行。参照/保存の全箇所をS3クライアントに差し替えること。
- FedEx連携（配送プラン、出荷伝票出力）
  - 現状 `app/api/shipping/fedx/route.ts` はモック/フォールバック実装。実連携は未実装。`Shipment` モデル（追跡番号/キャリア）と `shipping/label/*` ルート（PDF取得/アップロード）はあるため、実装方針は「既存 Shipment を基にFedEx API(認証→レート/出荷/ラベル)を段階的に置換」が適切。資格情報は `production.ts` に追加して環境変数管理へ。
- AI連携（画質補正）
  - `lib/services/config.ts` に `ai.openai` 設定はあるが、実処理は `app/components/features/inspection/PhotoUploader.tsx` でデモ的に扱うのみ。実運用には `/api/ai/...` のサーバー実装（入力バリデーション・署名・サイズ制限等）と、ストレージ（S3など）保存フローが必要。
- eBay連携（出品フォーム取得、出品、取り下げ、購入者決定、配送完了）
  - 現状 `app/api/ebay/listing/route.ts` と `/api/mock/ebay/listing` はDB更新中心の内部処理で、外部 eBay API 呼び出しそのものは未実装。`product-status-flow.drawio`/HTMLにも「アダプター準備中」と記載。
  - 「出品フォームもAPIで取得できるか？」について、本リポジトリ内には「eBay出品フォームのAPI取得」に関する実装/記述は一切ありません（URL参照はUIページであり、本コード内からの取得は未実装）。本件の可否は本リポジトリ情報のみでは断定不可です。

機能拡充
- スタッフのセラー管理一覧と詳細モーダル
  - `app/api/user/staff/route.ts` はありますが、「セラー管理一覧/詳細モーダル」専用のUI・APIは未実装。新規に `app/staff/sellers/page.tsx` と `SellerDetailModal`、対応する `/api/staff/sellers`（検索/ページネーション/詳細）追加が必要。
- 運営からのお知らせ通知（ベル、一覧、モーダル）
  - 通知APIは `app/api/notifications/route.ts`、`mark-as-read`、`dynamic` があり、UIは `app/components/EnhancedNotificationPanel.tsx` が存在。SSE は「準備中」と明記あり。ヘッダのベルアイコン連携や一覧・モーダルの結線は未完部分があるため、`DashboardLayout` への組込み、SSE本実装が必要。
- 決済サービス（１．サブスク、２．ロボットペイメント）
  - `lib/services/config.ts` に Stripe のキー定義のみ。決済API・Webhookは未実装。サブスク/都度課金・ロボットペイメント向けのAPI・UIは新規実装が必要（顧客/プラン/課金状態の保持は `SystemSetting` または新テーブルを検討）。
- ラベル出力（納品用/保管用、バーコード→商品詳細）
  - 既存: 出荷ラベル関連は `/api/shipping/label/*`、商品バーコードは `/api/products/barcode` 系、UI は `app/components/features/BarcodePrintButton.tsx` 等があるものの、「納品用A4」「保管用シール」テンプレートは未実装。要件に沿って:
    - A4/シール用の印刷ビュー（例: `app/labels/product-a4/page.tsx`, `app/labels/product-sticker/page.tsx`）
    - PDF生成（`pdfkit`/`pdfmake` 依存は既存）・ブラウザ印刷両対応
    - バーコードから `ProductDetailModal` へ遷移（現実装の `/api/products/[id]` 既存）

追加で明記すべきリスク/前提（本番移行前のブロッカー）
- 認証フォールバックとデモ分岐の無効化
  - `ALLOW_FIXED_AUTH` を本番で false、`app/api/**` の「デモ環境」分岐（認証バイパス/固定ユーザー）を本番では通らないよう統制すること。
- 接続管理の統一
  - `new PrismaClient()` 乱立を `lib/database.ts` 共有クライアントに統一（PostgreSQL運用の安定化）。
- 環境設定の一貫性
  - `config/environments/production.ts` と Prisma スキーマの不一致（postgresql/SQLite）解消。マイグレーション手順をドキュメント化。
- 監視・ログ
  - `production.ts` に Sentry/Datadog 定義があるが、実アプリへの組込み（DSN/APIキーの注入、エラーハンドリングの送出）は未確認。採番・PII 配慮も要整理。
- ローカルホスト参照の除去
  - API 内部で `http://localhost:*` をfetchする箇所を排除。本番では内部URLやキュー/イベントで代替。

補足（HTMLの表との対応）
- 「データ源/シード」「フロントのモック」「認証」「外部サービス/環境切替」「デモ/モック一覧」「リスク」は、`docs/system-architecture-audit.html` の各テーブルに詳細説明列を追加済みです。drawio との紐付け位置（構成層、ステータスフロー、ERの該当テーブル）は図面リンクから確認できます。

この計画に沿って進める場合、最初にやるべき順序（提案）
1) 本番ガード（固定認証とデモ分岐の停止）と Prisma クライアント統一
2) Prisma を PostgreSQL（Supabase）へ切替→マイグレーション→マスタ/初期ユーザーの最小シード
3) 監視・ログの注入（Sentry/Datadog）＋ヘルスチェック
4) ラベル出力（商品A4/シール）とバーコード遷移の実装
5) 通知（ベル/一覧/モーダル）を `EnhancedNotificationPanel` ベースで結線、SSE実装
6) FedEx → eBay → AI の順で、モック置換の外部連携を段階的に実装

出品フォームAPI可否については、本リポジトリ情報のみでは判断材料がないため、要件を「eBay APIのメタデータ・カテゴリ・アイテムスペックの取得と、社内出品UIへの反映」に言い換えて検討するのが安全です。

本番環境用の必須環境変数（現コードから抽出）
- DB: `DATABASE_URL`
- Auth: `JWT_SECRET`
- メール: `SENDGRID_API_KEY`, `SENDGRID_FROM_EMAIL`
- ストレージ: `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_REGION`, `S3_BUCKET_NAME`
- キャッシュ: `REDIS_URL`
- 監視: `SENTRY_DSN`, `DATADOG_API_KEY`
- eBay: `EBAY_APP_ID`, `EBAY_DEV_ID`, `EBAY_CERT_ID`（実装時はOAuthクレデンシャル類）
- FedEx: `FEDX_API_KEY`, `FEDX_SECRET_KEY`, `FEDX_ACCOUNT_NUMBER`, `FEDX_METER_NUMBER`, `FEDX_ENVIRONMENT`, `FEDX_BASE_URL`
- AI: `OPENAI_API_KEY`
- フラグ: `NODE_ENV=production`, `ALLOW_FIXED_AUTH=false`