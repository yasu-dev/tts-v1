# 開発作業規則

最終更新日: 2025年10月3日

## 概要

本文書は、ClaudeCodeおよびCursorエディターを使用した開発作業における必須ルールと推奨事項を定義します。

## 必須ルール

### 1. 真実性の確保

**決して嘘偽りないレポートを提示すること**

- すべてのレポート、ドキュメント、コード解析結果は事実に基づいたものでなければならない
- 推測や仮定を含む場合は、明確にその旨を記載する
- エラーや問題が発生した場合は、正確に報告する
- 実装状況や機能の動作確認結果は、実際のテスト結果に基づいて報告する

### 2. UIテストの必須実施

**UIテストを実施して、ソースコードベースのチェックだけではなく、UI操作をしたチェックを必ず、Playwrightにて確認すること**

- すべてのUI変更には、対応するPlaywrightテストを作成または更新する
- 以下の項目を必ずテストで確認する：
  - ユーザーインタラクション（クリック、入力、選択など）
  - 画面遷移とルーティング
  - レスポンシブデザインの動作
  - エラー処理とユーザーフィードバック
  - アクセシビリティ要件

### 3. ドキュメントの同期更新

**ソースコードの変更と合わせて、docsディレクトリのドキュメントも必ず更新すること**

- 以下の変更が発生した場合、該当するドキュメントを即座に更新する：
  - **仕様変更**: 要件定義書.md、技術スタック一覧.md
  - **構成変更**: system-architecture.drawio、README.md
  - **技術スタック変更**: 技術スタック一覧.md、package.json の依存関係
  - **ステータスフロー変更**: product-status-flow.drawio、要件定義書.md
  - **データベーススキーマ変更**: database-er-diagram.drawio、prisma/schema.prisma
  - **API追加・変更**: README.md、system-architecture.drawio
  - **環境設定変更**: 環境切り替え対応.md、.env.example

- ドキュメント更新後は、必ずHTMLドキュメントを再生成する：
  ```bash
  npm run docs:generate
  ```

- ドキュメントの陳腐化を防ぐため、以下のチェックリストを使用：
  - [ ] ソースコードとドキュメントの内容が一致しているか
  - [ ] バージョン番号や日付が最新か
  - [ ] drawio図が実装と一致しているか
  - [ ] HTMLドキュメントが再生成されているか

## 推奨事項

### コード品質

1. **既存ファイルの優先編集**
   - 新規ファイル作成より既存ファイルの編集を優先する
   - 必要な場合のみ新規ファイルを作成する

2. **ドキュメンテーション**
   - ドキュメントファイル（*.md）は明示的に要求された場合のみ作成する
   - コード内のコメントは最小限に抑える

3. **環境設定の確認**
   - 作業前に現在の環境設定を確認する
   - 環境変数の変更は慎重に行う

### テスト戦略

1. **E2Eテストの実施**
   ```bash
   # 全テストの実行
   npm run e2e
   
   # 特定のテストファイルの実行
   npm run e2e <test-file-name>
   ```

2. **テストカバレッジ**
   - 新機能には必ず対応するテストを作成
   - 既存機能の修正時は関連テストを更新
   - UI変更は視覚的な確認も含める

3. **テスト結果の記録**
   - テスト実行結果はJSONファイルに保存
   - 失敗したテストは原因を分析し、修正する

### 開発フロー

1. **タスク管理**
   - TodoWriteツールを使用してタスクを管理
   - タスクの進捗を定期的に更新
   - 完了したタスクは速やかにマークする

2. **コードレビュー**
   - セルフレビューを実施
   - リント（`npm run lint`）とタイプチェック（`npm run typecheck`）を実行
   - テストがすべてパスすることを確認

3. **コミット規則**
   - 明確で簡潔なコミットメッセージ
   - 関連する変更をまとめてコミット
   - 機密情報を含まないことを確認

## Playwrightテストの実装例

```typescript
import { test, expect } from '@playwright/test';

test.describe('機能名', () => {
  test('UIの動作確認', async ({ page }) => {
    // ページへのナビゲーション
    await page.goto('/target-page');
    
    // 要素の存在確認
    await expect(page.locator('selector')).toBeVisible();
    
    // ユーザーインタラクション
    await page.click('button[type="submit"]');
    
    // 結果の検証
    await expect(page.locator('.result')).toHaveText('期待される結果');
  });
});
```

## エラー処理

1. **エラーログの記録**
   - すべてのエラーは適切にログに記録
   - スタックトレースを含める
   - 再現手順を記載

2. **エラーレポート**
   - エラーの原因を正確に特定
   - 修正方法を提案
   - 修正後の動作確認を実施

## まとめ

これらのルールに従うことで、高品質で信頼性の高いコードベースを維持し、効率的な開発プロセスを実現できます。特に、真実性の確保とUIテストの実施は、プロジェクトの成功に不可欠な要素です。