# ECサイトデモ操作手順書

## 概要

本ドキュメントは、献立ガチャECサイト（購入者向けサイト）の主要機能を網羅したデモ操作手順書です。
新規ユーザー登録からログイン、商品検索、購入、レビュー投稿、チャット機能まで、一連の操作フローを説明します。

## 前提条件

- consumer-siteが起動していること（`http://localhost:3000`）
- Supabaseデータベースが適切にセットアップされていること
- テストデータ（商品・販売者）が登録されていること
- Stripe決済が設定されている場合はテストモードであること

## デモ手順

### 1. トップページアクセス

**URL**: `http://localhost:3000`

**確認事項**:
- 献立ガチャのロゴとキャッチコピーが表示される
- 商品一覧がカード形式で表示される
- 各商品カードに以下の情報が表示される:
  - 商品名
  - カテゴリー（果菜/葉物/根菜など）
  - 商品説明（2行まで）
  - 農家名
  - 産地
  - 価格帯（¥XXX - ¥XXX）
  - 「詳細」ボタン

**操作**:
1. ブラウザで`http://localhost:3000`にアクセス
2. 表示されている商品を確認
3. 任意の商品の「詳細」ボタンをクリック

---

### 2. 新規ユーザー登録

**URL**: `http://localhost:3000/auth/signup`

**操作手順**:
1. トップページまたはヘッダーから「ログイン」をクリック
2. ログインページで「アカウントをお持ちでない方はこちら」をクリック
3. サインアップフォームに以下を入力:
   - メールアドレス: `test-buyer@example.com`
   - パスワード: `Test1234!`
   - パスワード確認: `Test1234!`
4. 「登録」ボタンをクリック
5. メール確認のメッセージが表示されることを確認

**確認事項**:
- 入力バリデーションが動作する
- パスワードの強度チェックが動作する
- メール確認リンクの送信メッセージが表示される

**注意**:
- 実際の運用では、メール認証が必要
- デモ環境では、Supabaseのダッシュボードで手動確認も可能

---

### 3. ログイン

**URL**: `http://localhost:3000/auth/login`

**操作手順**:
1. ログインページにアクセス
2. 以下の情報を入力:
   - メールアドレス: `test-buyer@example.com`
   - パスワード: `Test1234!`
3. 「ログイン」ボタンをクリック
4. トップページにリダイレクトされることを確認

**確認事項**:
- 認証が成功する
- ヘッダーにユーザー情報が表示される
- ログイン後のナビゲーションが表示される（プロフィール、注文履歴など）

---

### 4. プロフィール設定

**URL**: `http://localhost:3000/profile`

**操作手順**:
1. ヘッダーまたは下部ナビゲーションから「マイページ」をクリック
2. プロフィール情報を入力:
   - ニックネーム: `田中太郎`
   - 氏名: `田中 太郎`
   - 電話番号: `090-1234-5678`
3. 配送先情報を入力:
   - 郵便番号: `100-0001`
   - 都道府県: `東京都`
   - 市区町村: `千代田区`
   - 住所1: `丸の内1-1-1`
   - 住所2: `マンション101号室`
   - 受取人名: `田中 太郎`
   - 電話番号: `090-1234-5678`
4. 「保存」ボタンをクリック

**確認事項**:
- プロフィールが正常に保存される
- 保存成功のメッセージが表示される
- 配送先情報が後のチェックアウトで自動入力される

---

### 5. 商品検索（野菜から探す）

**URL**: `http://localhost:3000/vegetables/[野菜名]/farmers`

**操作手順**:
1. トップページまたは検索ページにアクセス
2. 「野菜から探す」セクションで野菜を選択（例: トマト）
3. その野菜を出品している農家の一覧が表示される
4. 農家カードから商品を選択

**確認事項**:
- 選択した野菜に関連する商品のみが表示される
- 各農家の情報（農家名、プロフィール画像、紹介文）が表示される
- 商品の価格帯と在庫状況が確認できる

---

### 6. 商品詳細ページ

**URL**: `http://localhost:3000/product/[商品ID]`

**操作手順**:
1. 商品一覧から任意の商品をクリック
2. 商品詳細ページで以下の情報を確認:
   - 商品画像（複数ある場合はギャラリー表示）
   - 商品名・カテゴリー
   - 商品説明
   - 産地
   - **規格外理由**（重要: 献立ガチャの特徴）
   - 販売者情報（農家名、プロフィール、所在地）
   - SKU選択（重量/数量オプション）
   - 価格
   - 在庫状況
   - レビュー一覧

**SKU選択と数量指定**:
1. 利用可能なSKUから選択（例: 500g, 1kg, 2kgなど）
2. 購入数量を入力（例: 2個）
3. 「カートに追加」ボタンをクリック

**確認事項**:
- SKUに応じて価格が変動する
- 在庫数以上は購入できない
- カート追加成功のメッセージが表示される

---

### 7. カート確認

**URL**: `http://localhost:3000/cart`

**操作手順**:
1. ヘッダーまたは下部ナビゲーションの「カート」アイコンをクリック
2. カート内の商品を確認:
   - 商品名・SKU・数量
   - 単価・小計
   - 販売者別にグループ化されている
3. 必要に応じて数量を変更または削除
4. 小計・送料・合計金額を確認
5. 「購入手続きへ」ボタンをクリック

**確認事項**:
- 商品の追加・削除・数量変更が正常に動作する
- 金額計算が正確である（商品小計 + 送料）
- 複数の販売者の商品がある場合、販売者ごとに表示される

---

### 8. チェックアウト（配送先入力）

**URL**: `http://localhost:3000/checkout/shipping`

**操作手順**:
1. カートから「購入手続きへ」をクリック
2. 配送先情報を確認・編集:
   - プロフィールで設定した配送先が自動入力される
   - 必要に応じて別の配送先を入力
3. お届け予定日を選択（販売者が設定した配送可能日から）
4. 配送時間帯を選択（午前・午後・指定なし）
5. 「支払い方法へ進む」ボタンをクリック

**確認事項**:
- プロフィールの配送先が自動入力される
- 配送先の変更・追加が可能
- お届け予定日が適切に表示される

---

### 9. 決済（Stripe Checkout）

**URL**: `http://localhost:3000/checkout/pay`

**操作手順**:
1. 注文内容を最終確認:
   - 商品詳細
   - 配送先
   - 金額（小計・送料・プラットフォーム手数料・合計）
2. 「支払いへ進む」ボタンをクリック
3. Stripe Checkoutページにリダイレクト
4. テストカード情報を入力:
   - カード番号: `4242 4242 4242 4242`
   - 有効期限: `12/34`
   - CVC: `123`
   - 郵便番号: `12345`
5. 「支払う」ボタンをクリック

**確認事項**:
- Stripe Checkoutが正常に表示される
- テスト決済が成功する
- 成功時に注文完了ページにリダイレクトされる
- 決済失敗時に適切なエラーメッセージが表示される

---

### 10. 注文完了

**URL**: `http://localhost:3000/order/complete?order=[注文ID]`

**確認事項**:
1. 注文完了のメッセージが表示される
2. 注文番号が表示される
3. 注文内容のサマリーが表示される:
   - 購入商品
   - 配送先
   - 配送予定日
   - 支払い金額
4. 「注文履歴を見る」ボタンが表示される
5. メール通知が送信される（購入完了メール）

**メール確認**:
- 件名: `【献立ガチャ】ご購入ありがとうございます（注文番号: [注文番号]）`
- 本文: 注文内容、配送予定日、連絡先

---

### 11. 注文履歴

**URL**: `http://localhost:3000/orders`

**操作手順**:
1. ヘッダーまたは下部ナビゲーションから「注文履歴」をクリック
2. 過去の注文一覧を確認:
   - 注文番号
   - 注文日時
   - ステータス（pending/paid/shipped/delivered/canceled）
   - 合計金額
3. 任意の注文をクリックして詳細を表示

**注文詳細ページ** (`/orders/[注文ID]`):
- 注文番号・注文日時
- ステータス
- 商品詳細（商品名・SKU・数量・単価・小計）
- 配送先情報
- 金額詳細（小計・送料・手数料・合計）
- 配送予定日
- 追跡番号（発送後）
- 「レビューを書く」ボタン（配送完了後）
- 「販売者にメッセージ」ボタン

**確認事項**:
- 注文履歴が正確に表示される
- ステータスが適切に更新される
- 各注文の詳細情報にアクセスできる

---

### 12. レビュー投稿

**URL**: 注文詳細ページから

**操作手順**:
1. 注文詳細ページで「レビューを書く」ボタンをクリック
2. レビューフォームに以下を入力:
   - 星評価: ★★★★★（1〜5つ星）
   - コメント: `新鮮で美味しかったです！規格外とは思えないくらい良い状態でした。`
   - 画像アップロード: 最大3枚（任意）
3. 「投稿」ボタンをクリック

**確認事項**:
- レビューが正常に投稿される
- 投稿したレビューが商品詳細ページに表示される
- ニックネームが表示される（匿名ではなく設定したニックネーム）
- 画像付きレビューの場合、画像が正しく表示される

---

### 13. チャット機能（販売者とのメッセージ）

**URL**: `http://localhost:3000/chat/[販売者ID]`

**操作手順**:
1. 商品詳細ページまたは注文詳細ページから「販売者にメッセージ」をクリック
2. チャットページが開く
3. メッセージを入力:
   ```
   こんにちは。注文した商品について質問があります。
   配送予定日を前倒しすることは可能でしょうか？
   ```
4. 「送信」ボタンをクリック
5. メッセージが送信され、チャット履歴に表示される

**確認事項**:
- メッセージがリアルタイムで表示される（Supabase Realtime使用）
- 既読・未読ステータスが表示される
- 販売者からの返信が正常に受信できる
- チャット一覧ページ（`/chat`）で未読メッセージ数が表示される

---

### 14. チャット一覧

**URL**: `http://localhost:3000/chat`

**操作手順**:
1. ヘッダーまたは下部ナビゲーションから「チャット」をクリック
2. 販売者とのチャットスレッド一覧を確認:
   - 販売者名・農家名
   - 最新メッセージのプレビュー
   - 最終メッセージ日時
   - 未読件数（バッジ表示）
3. 任意のスレッドをクリックしてチャットページを開く

**確認事項**:
- チャット履歴が時系列順に表示される
- 未読メッセージがハイライトされる
- リアルタイム更新が動作する

---

### 15. 検索機能

**URL**: `http://localhost:3000/search`

**操作手順**:
1. ヘッダーの検索アイコンをクリック
2. 検索キーワードを入力（例: `トマト`）
3. 検索結果が表示される:
   - 商品名・説明に該当する商品
   - カテゴリーフィルター
   - 価格範囲フィルター
   - 産地フィルター
4. フィルターを適用して絞り込む
5. 検索結果から商品を選択

**確認事項**:
- キーワード検索が正常に動作する
- フィルターが適切に適用される
- 検索結果が関連性順に表示される

---

### 16. ログアウト

**操作手順**:
1. ヘッダーまたはメニューから「ログアウト」をクリック
2. ログアウト確認ダイアログが表示される（オプション）
3. 「ログアウト」を確認
4. ログインページまたはトップページにリダイレクト

**確認事項**:
- セッションが正常にクリアされる
- ログイン前の状態に戻る
- 保護されたページにアクセスするとログインページにリダイレクトされる

---

## 下部ナビゲーション（スマホファースト）

consumer-siteはスマホファーストで設計されており、下部ナビゲーションが利用できます：

1. **ホーム**（🎰ガチャ）: トップページ
2. **検索**: 商品検索
3. **履歴**: 注文履歴
4. **チャット**: チャット一覧
5. **マイ**: プロフィール・設定

---

## テストシナリオ例

### シナリオ1: 初回購入フロー
1. 新規ユーザー登録
2. プロフィール設定
3. 商品検索
4. 商品詳細確認
5. カート追加
6. チェックアウト
7. 決済
8. 注文完了

**所要時間**: 約5〜10分

### シナリオ2: リピート購入フロー
1. ログイン
2. トップページから商品選択
3. カート追加
4. チェックアウト（配送先は自動入力）
5. 決済
6. 注文完了

**所要時間**: 約3〜5分

### シナリオ3: レビュー投稿フロー
1. ログイン
2. 注文履歴から過去の注文を選択
3. レビューを書く
4. 星評価・コメント・画像を投稿
5. 商品詳細ページでレビューを確認

**所要時間**: 約2〜3分

### シナリオ4: チャットフロー
1. 商品詳細ページから販売者にメッセージ
2. メッセージ送信
3. チャット一覧で未読確認
4. 返信を確認
5. 会話を続ける

**所要時間**: 約3〜5分

---

## トラブルシューティング

### 商品が表示されない
- Supabaseで商品データが登録されているか確認
- `products.is_active = true` になっているか確認
- RLSポリシーが正しく設定されているか確認

### ログインできない
- メール認証が完了しているか確認（Supabaseダッシュボード）
- 環境変数（NEXT_PUBLIC_SUPABASE_URL等）が正しいか確認
- ブラウザのキャッシュをクリア

### 決済が失敗する
- Stripe APIキーが正しく設定されているか確認
- テストモードになっているか確認
- Webhook URLが正しく設定されているか確認

### チャットが更新されない
- Supabase Realtimeが有効になっているか確認
- ブラウザがWebSocketをサポートしているか確認

### 画像が表示されない
- Supabase Storageのバケットが作成されているか確認
- RLSポリシーで画像へのアクセスが許可されているか確認
- 画像URLが正しいか確認

---

## まとめ

本デモ手順書では、献立ガチャECサイトの主要機能を網羅的に確認しました。

**実装済み機能**:
- ユーザー認証（登録・ログイン・ログアウト）
- プロフィール管理
- 商品検索・閲覧
- カート機能
- チェックアウト・決済（Stripe）
- 注文履歴
- レビュー機能
- チャット機能（販売者との1対1）

**今後の拡張機能**:
- 献立ガチャUI（Framer Motionを使用した回転/ポップ演出）
- お気に入り機能
- クーポン・ポイントシステム
- 定期購入
- プッシュ通知

本手順書を参考に、システムの動作確認やデモンストレーションを実施してください。
