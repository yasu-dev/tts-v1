<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>トリアージシステム デモ用QRコード #2</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .patient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .patient-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            page-break-inside: avoid;
        }
        .patient-card h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .qr-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .patient-info {
            font-size: 14px;
            line-height: 1.8;
        }
        .patient-info strong {
            color: #2c3e50;
            display: inline-block;
            min-width: 120px;
        }
        .tag-label {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .tag-red { background-color: #e74c3c; color: white; }
        .tag-yellow { background-color: #f39c12; color: white; }
        .tag-green { background-color: #27ae60; color: white; }
        .tag-black { background-color: #34495e; color: white; }
        .start-answers {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }
        .start-answers strong {
            color: #2e7d32;
        }
        .answer-yes {
            color: #2e7d32;
            font-weight: bold;
        }
        .answer-no {
            color: #c62828;
            font-weight: bold;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 30px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }
        @media print {
            body {
                background: white;
            }
            .patient-card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            .instructions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>🏥 トリアージシステム デモ用QRコード #2</h1>

    <div class="instructions">
        <h3>使い方</h3>
        <p>
            1. このページを印刷するか、タブレット/スマホで表示します<br>
            2. トリアージ画面（/triage/scan）で「QRコード読み込み」を選択<br>
            3. カメラでQRコードをスキャン<br>
            4. 患者情報が自動入力されます
        </p>
    </div>

    <div class="patient-grid" id="patientGrid"></div>

    <script>
        const demoPatients = [
            {
                id: "DEMO-007",
                name: "田中 健一",
                age: 45,
                gender: "男性",
                location: "新宿区西新宿1-5-10",
                chiefComplaint: "左肩打撲",
                vitals: {
                    respiratoryRate: 16,
                    heartRate: 80,
                    spO2: 98,
                    bloodPressure: "125/78",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: true,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "緑",
                notes: "歩行可能、軽度の打撲のみ"
            },
            {
                id: "DEMO-008",
                name: "佐藤 美咲",
                age: 58,
                gender: "女性",
                location: "新宿区西新宿1-6-15",
                chiefComplaint: "腹部刺創、多量出血",
                vitals: {
                    respiratoryRate: 32,
                    heartRate: 135,
                    spO2: 86,
                    bloodPressure: "75/50",
                    consciousnessLevel: "JCS 2"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "赤",
                notes: "呼吸数30回/分以上、ショック状態"
            },
            {
                id: "DEMO-009",
                name: "鈴木 翔太",
                age: 32,
                gender: "男性",
                location: "新宿区西新宿1-7-20",
                chiefComplaint: "右膝関節脱臼",
                vitals: {
                    respiratoryRate: 22,
                    heartRate: 95,
                    spO2: 96,
                    bloodPressure: "135/82",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "黄",
                notes: "歩行不可だが、バイタル安定、意識清明"
            },
            {
                id: "DEMO-010",
                name: "山田 太郎",
                age: 73,
                gender: "男性",
                location: "新宿区西新宿1-8-5",
                chiefComplaint: "心肺停止",
                vitals: {
                    respiratoryRate: 0,
                    heartRate: 0,
                    spO2: 0,
                    bloodPressure: "0/0",
                    consciousnessLevel: "JCS 300"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: false,
                    hasRadialPulse: false,
                    followsCommands: false
                },
                expectedTag: "黒",
                notes: "呼吸なし、心肺停止状態"
            },
            {
                id: "DEMO-011",
                name: "高橋 由美",
                age: 23,
                gender: "女性",
                location: "新宿区西新宿1-9-12",
                chiefComplaint: "右足首捻挫、軽度",
                vitals: {
                    respiratoryRate: 15,
                    heartRate: 75,
                    spO2: 99,
                    bloodPressure: "118/72",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: true,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "緑",
                notes: "歩行可能、軽度の捻挫"
            },
            {
                id: "DEMO-012",
                name: "渡辺 誠",
                age: 61,
                gender: "男性",
                location: "新宿区西新宿1-10-8",
                chiefComplaint: "頭部外傷、意識混濁",
                vitals: {
                    respiratoryRate: 26,
                    heartRate: 115,
                    spO2: 90,
                    bloodPressure: "95/60",
                    consciousnessLevel: "JCS 20"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: false
                },
                expectedTag: "赤",
                notes: "意識レベル低下、指示に従えず"
            },
            {
                id: "DEMO-013",
                name: "伊藤 花子",
                age: 39,
                gender: "女性",
                location: "新宿区西新宿1-11-3",
                chiefComplaint: "左前腕骨折",
                vitals: {
                    respiratoryRate: 19,
                    heartRate: 88,
                    spO2: 97,
                    bloodPressure: "128/80",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "黄",
                notes: "骨折により歩行不可、バイタル安定"
            },
            {
                id: "DEMO-014",
                name: "中村 一郎",
                age: 50,
                gender: "男性",
                location: "新宿区西新宿1-12-7",
                chiefComplaint: "顔面擦過傷",
                vitals: {
                    respiratoryRate: 17,
                    heartRate: 82,
                    spO2: 98,
                    bloodPressure: "132/85",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: true,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "緑",
                notes: "歩行可能、軽度の擦過傷のみ"
            },
            {
                id: "DEMO-015",
                name: "小林 恵子",
                age: 44,
                gender: "女性",
                location: "新宿区西新宿1-13-1",
                chiefComplaint: "胸部圧迫外傷、ショック状態",
                vitals: {
                    respiratoryRate: 28,
                    heartRate: 125,
                    spO2: 85,
                    bloodPressure: "80/55",
                    consciousnessLevel: "JCS 3"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: false,
                    followsCommands: true
                },
                expectedTag: "赤",
                notes: "橈骨動脈触知不可、ショック状態"
            },
            {
                id: "DEMO-016",
                name: "加藤 龍一",
                age: 29,
                gender: "男性",
                location: "新宿区西新宿1-14-9",
                chiefComplaint: "腰椎圧迫骨折疑い",
                vitals: {
                    respiratoryRate: 21,
                    heartRate: 90,
                    spO2: 95,
                    bloodPressure: "138/88",
                    consciousnessLevel: "JCS 0"
                },
                startAssessment: {
                    canWalk: false,
                    isBreathing: true,
                    hasRadialPulse: true,
                    followsCommands: true
                },
                expectedTag: "黄",
                notes: "腰椎損傷疑い、歩行不可だがバイタル安定"
            }
        ];

        function getTagClass(tag) {
            const tagMap = {
                '赤': 'tag-red',
                '黄': 'tag-yellow',
                '緑': 'tag-green',
                '黒': 'tag-black'
            };
            return tagMap[tag] || '';
        }

        function getStartAnswers(patient) {
            const answers = [];

            // Q1: 歩行可能か
            const q1Answer = patient.startAssessment.canWalk;
            answers.push(`Q1: 歩行できますか？ → <span class="answer-${q1Answer ? 'yes' : 'no'}">${q1Answer ? 'はい' : 'いいえ'}</span>`);

            // 歩行可能なら緑タグで終了
            if (q1Answer) {
                return answers.join('<br>');
            }

            // Q2: 呼吸があるか
            const q2Answer = patient.startAssessment.isBreathing;
            answers.push(`Q2: 呼吸はしていますか？ → <span class="answer-${q2Answer ? 'yes' : 'no'}">${q2Answer ? 'はい' : 'いいえ'}</span>`);

            // 呼吸がなければ黒タグで終了
            if (!q2Answer) {
                return answers.join('<br>');
            }

            // Q3: 呼吸数が30回/分未満か
            const q3Answer = patient.vitals.respiratoryRate < 30;
            answers.push(`Q3: 呼吸数は30回/分未満ですか？ → <span class="answer-${q3Answer ? 'yes' : 'no'}">${q3Answer ? 'はい' : 'いいえ'}</span>`);

            // 呼吸数が30以上なら赤タグで終了
            if (!q3Answer) {
                return answers.join('<br>');
            }

            // Q4: 橈骨動脈触知可能か
            const q4Answer = patient.startAssessment.hasRadialPulse;
            answers.push(`Q4: 橈骨動脈は触れますか？ → <span class="answer-${q4Answer ? 'yes' : 'no'}">${q4Answer ? 'はい' : 'いいえ'}</span>`);

            // 脈が触れなければ赤タグで終了
            if (!q4Answer) {
                return answers.join('<br>');
            }

            // Q5: 指示に従えるか
            const q5Answer = patient.startAssessment.followsCommands;
            answers.push(`Q5: 指示に従えますか？ → <span class="answer-${q5Answer ? 'yes' : 'no'}">${q5Answer ? 'はい' : 'いいえ'}</span>`);

            return answers.join('<br>');
        }

        function createPatientCard(patient) {
            const card = document.createElement('div');
            card.className = 'patient-card';

            const qrData = JSON.stringify({
                id: patient.id,
                age: patient.age,
                gender: patient.gender,
                location: patient.location,
                chiefComplaint: patient.chiefComplaint,
                vitals: patient.vitals,
                startAssessment: patient.startAssessment
            });

            const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrData)}`;
            const startAnswersHtml = getStartAnswers(patient);

            card.innerHTML = `
                <h2>
                    ${patient.name}
                    <span class="tag-label ${getTagClass(patient.expectedTag)}">${patient.expectedTag}タグ</span>
                </h2>
                <div class="qr-container">
                    <img src="${qrImageUrl}" alt="QRコード ${patient.id}" />
                </div>
                <div class="patient-info">
                    <div><strong>ID:</strong> ${patient.id}</div>
                    <div><strong>年齢:</strong> ${patient.age}歳</div>
                    <div><strong>性別:</strong> ${patient.gender}</div>
                    <div><strong>発見場所:</strong> ${patient.location}</div>
                    <div><strong>主訴:</strong> ${patient.chiefComplaint}</div>
                    <div style="margin-top: 10px;"><strong>バイタルサイン:</strong></div>
                    <div style="margin-left: 20px;">
                        呼吸: ${patient.vitals.respiratoryRate}回/分<br>
                        心拍: ${patient.vitals.heartRate}回/分<br>
                        SpO2: ${patient.vitals.spO2}%<br>
                        血圧: ${patient.vitals.bloodPressure}<br>
                        意識: ${patient.vitals.consciousnessLevel}
                    </div>
                    <div class="start-answers">
                        <strong>📋 START法の回答:</strong><br>
                        ${startAnswersHtml}
                    </div>
                    <div style="margin-top: 10px;"><strong>備考:</strong> ${patient.notes}</div>
                </div>
            `;

            document.getElementById('patientGrid').appendChild(card);
        }

        demoPatients.forEach(patient => createPatientCard(patient));
    </script>
</body>
</html>
