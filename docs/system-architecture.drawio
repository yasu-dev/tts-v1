<mxfile host="app.diagrams.net" modified="2025-10-18T20:00:00.000Z" agent="Claude Code" version="24.0.0">
  <diagram name="トリアージタッグシステム アーキテクチャ (MVP)" id="tts-architecture-mvp">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="トリアージタッグシステム&#xa;システムアーキテクチャ (MVP v1.0)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=26;fontStyle=1;fontColor=#485563" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="600" height="60" as="geometry" />
        </mxCell>

        <!-- Client Layer -->
        <mxCell id="client-layer" value="クライアント層（現場デバイス）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=16;fontStyle=1;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="100" width="1280" height="80" as="geometry" />
        </mxCell>

        <mxCell id="tablet" value="タブレット&#xa;(iPad, Android)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="130" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="mobile" value="スマートフォン&#xa;(iOS, Android)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="130" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="desktop" value="PC/ノートPC&#xa;(指揮本部・医療機関)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="130" width="220" height="40" as="geometry" />
        </mxCell>

        <mxCell id="browser-note" value="PWAブラウザ対応&#xa;(Phase 2実装予定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="740" y="130" width="180" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow from Client to Frontend -->
        <mxCell id="arrow-client-frontend" value="HTTPS" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;strokeWidth=3;strokeColor=#E87722;" edge="1" parent="1" source="client-layer" target="frontend-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Frontend Layer -->
        <mxCell id="frontend-layer" value="フロントエンド層 (MVP実装済み)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=16;fontStyle=1;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="210" width="1280" height="120" as="geometry" />
        </mxCell>

        <mxCell id="nextjs" value="Next.js 14&#xa;App Router" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#E87722;fontSize=13;fontStyle=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="250" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="react" value="React 18&#xa;Server Components" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="240" y="250" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="typescript" value="TypeScript&#xa;型安全性" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="400" y="250" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tailwind" value="Tailwind CSS&#xa;UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="540" y="250" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="qr-scanner" value="html5-qrcode&#xa;QR読取" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="670" y="250" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="voice-api" value="Web Speech API&#xa;音声認識" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="800" y="250" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="leaflet-planned" value="react-leaflet&#xa;(地図表示予定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="940" y="250" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="components-note" value="UI Components&#xa;(部分実装)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1080" y="250" width="110" height="60" as="geometry" />
        </mxCell>

        <!-- Arrow from Frontend to Backend -->
        <mxCell id="arrow-frontend-backend" value="API Request / Response" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;strokeWidth=3;strokeColor=#E87722;" edge="1" parent="1" source="frontend-layer" target="backend-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Backend Layer -->
        <mxCell id="backend-layer" value="バックエンド層 (MVP実装済み)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;fontStyle=1;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="360" width="1280" height="120" as="geometry" />
        </mxCell>

        <mxCell id="api-routes" value="Next.js&#xa;API Routes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="400" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="supabase-client" value="Supabase&#xa;Client/Server" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="400" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="middleware" value="Middleware&#xa;セッション管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="400" y="400" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="types" value="TypeScript&#xa;型定義完備" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="540" y="400" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="auth-simple" value="簡易認証&#xa;(Auth未統合)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="670" y="400" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="phase2-backend" value="Phase 2&#xa;監査ログ/CRDT&#xa;(未実装)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="400" width="110" height="60" as="geometry" />
        </mxCell>

        <!-- Arrow from Backend to Database -->
        <mxCell id="arrow-backend-database" value="SQL Query / Supabase SDK" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;strokeWidth=3;strokeColor=#E87722;" edge="1" parent="1" source="backend-layer" target="database-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Database Layer -->
        <mxCell id="database-layer" value="データベース層 (Supabase - MVP実装済み)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=16;fontStyle=1;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="510" width="640" height="110" as="geometry" />
        </mxCell>

        <mxCell id="supabase-postgres" value="PostgreSQL 15&#xa;7テーブル実装" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="550" width="160" height="60" as="geometry" />
        </mxCell>

        <mxCell id="demo-data" value="デモデータ投入済&#xa;(7患者・3病院)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="550" width="150" height="60" as="geometry" />
        </mxCell>

        <mxCell id="supabase-storage" value="Supabase Storage&#xa;(画像保存予定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="450" y="550" width="130" height="60" as="geometry" />
        </mxCell>

        <mxCell id="realtime-planned" value="Realtime&#xa;(Phase 2予定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="600" y="550" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- Phase 2 Features -->
        <mxCell id="phase2-layer" value="Phase 2 機能 (未実装)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=16;fontStyle=2;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="740" y="510" width="600" height="110" as="geometry" />
        </mxCell>

        <mxCell id="phase2-pwa" value="PWA&#xa;オフライン対応" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="760" y="550" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="phase2-ai" value="AI/ML&#xa;画像解析・判定" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="880" y="550" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="phase2-security" value="MFA・監査ログ&#xa;暗号化" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="1010" y="550" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="phase2-satellite" value="衛星通信&#xa;メッシュ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="1140" y="550" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- Current Implementation -->
        <mxCell id="impl-box" value="現在の実装状況 (MVP v1.0)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;verticalAlign=top;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="60" y="650" width="640" height="290" as="geometry" />
        </mxCell>

        <mxCell id="impl-completed" value="✅ 実装完了 (約65%)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="680" width="580" height="25" as="geometry" />
        </mxCell>

        <mxCell id="impl-list" value="・Next.js 14 + React 18 + TypeScript + Tailwind CSS&#xa;・Supabase (PostgreSQL + Auth + Storage)&#xa;・データベーススキーマ + デモデータ完備&#xa;・指揮本部画面 (トリアージタグ一覧・集計)&#xa;・搬送管理画面 (病院選択・搬送開始)&#xa;・病院画面 (受入管理・状況更新)&#xa;・QR/音声/STARTコンポーネント準備&#xa;・GitHub リポジトリ管理完了" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=20;" vertex="1" parent="1">
          <mxGeometry x="80" y="710" width="580" height="110" as="geometry" />
        </mxCell>

        <mxCell id="impl-partial" value="⚠️ 部分実装・未接続 (約20%)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1;fontColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="80" y="830" width="580" height="25" as="geometry" />
        </mxCell>

        <mxCell id="partial-list" value="・トリアージ入力画面 (コンポーネント未統合)&#xa;・Supabase Auth統合 (簡易認証のみ)&#xa;・地図表示 (react-leaflet未実装)&#xa;・リアルタイム更新 (手動リロードのみ)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=20;" vertex="1" parent="1">
          <mxGeometry x="80" y="860" width="580" height="60" as="geometry" />
        </mxCell>

        <!-- Phase 2 Details -->
        <mxCell id="phase2-box" value="Phase 2 以降の機能 (未実装で正しい)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=2;verticalAlign=top;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="740" y="650" width="600" height="290" as="geometry" />
        </mxCell>

        <mxCell id="phase2-title" value="❌ Phase 2・Phase 3機能 (約15%)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="760" y="680" width="560" height="25" as="geometry" />
        </mxCell>

        <mxCell id="phase2-list" value="セキュリティ強化:&#xa;  ・MFA (多要素認証)&#xa;  ・オフライン暗号化 (IndexedDB + AES-256)&#xa;  ・監査ログ (ハッシュチェーン)&#xa;&#xa;オフライン対応:&#xa;  ・PWA (Service Worker + Cache)&#xa;  ・CRDT (Yjs) 競合解決&#xa;  ・衛星通信モード&#xa;&#xa;AI/ML機能:&#xa;  ・ドローン画像解析 (TensorFlow.js + YOLOv8)&#xa;  ・トリアージ判定AI&#xa;  ・搬送先マッチング最適化&#xa;&#xa;外部連携:&#xa;  ・Google Maps API (代替: react-leaflet)&#xa;  ・ドローン/DMAT/LLM API連携&#xa;&#xa;高度化:&#xa;  ・訓練モード、予測分析、バイオメトリクス&#xa;  ・PDF/CSV出力、詳細レポート" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=20;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="760" y="710" width="560" height="210" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="凡例" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#485563;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10;spacingTop=10;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="60" y="960" width="1280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-core" value="実装済み" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#E87722;fontSize=11;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="200" y="965" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-partial" value="部分実装" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="320" y="965" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-future" value="Phase 2以降" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="440" y="965" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-db" value="データベース" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="560" y="965" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-success" value="完成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="965" width="100" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
