<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>技術スタック一覧</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --code-bg: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif, 'Noto Sans JP';
            line-height: 1.8;
            color: var(--text-primary);
            background-color: var(--bg-light);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-white);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
        }

        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h4 {
            color: var(--text-primary);
            font-size: 1.25rem;
            margin-top: 25px;
            margin-bottom: 12px;
        }

        h5, h6 {
            color: var(--text-primary);
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        ul, ol {
            margin-bottom: 15px;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: var(--bg-light);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #d63384;
        }

        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
            font-size: 0.95em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
            color: var(--text-primary);
        }

        tr:nth-child(even) {
            background: #f8fafc;
        }

        hr {
            border: none;
            border-top: 2px solid var(--border-color);
            margin: 30px 0;
        }

        strong {
            font-weight: 600;
            color: var(--text-primary);
        }

        em {
            font-style: italic;
        }

        blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 20px;
            margin: 20px 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 6px;
            text-decoration: none;
        }

        .back-link:hover {
            background: #1d4ed8;
            text-decoration: none;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
            .back-link {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← 引き継ぎ資料トップに戻る</a>
        <h1>THE WORLD DOOR フルフィルメントシステム</h1>
<h1>技術スタック仕様書</h1>

<p>
<strong>文書番号</strong>: TWD-TECH-001
<strong>バージョン</strong>: 3.0
<strong>発行日</strong>: 2025年1月13日
<strong>更新日</strong>: 2025年10月3日
<strong>作成者</strong>: 技術開発部
<strong>承認者</strong>: CTO
</p>

<hr>

<h2>目次</h2>

<ul>
<li><a href="#1-はじめに">はじめに</a></li>
<li><a href="#2-システム概要">システム概要</a></li>
<li><a href="#3-技術選定方針">技術選定方針</a></li>
<li><a href="#4-フロントエンド技術スタック">フロントエンド技術スタック</a></li>
<li><a href="#5-バックエンド技術スタック">バックエンド技術スタック</a></li>
<li><a href="#6-インフラストラクチャ">インフラストラクチャ</a></li>
<li><a href="#7-開発環境">開発環境</a></li>
<li><a href="#8-セキュリティ要件">セキュリティ要件</a></li>
<li><a href="#9-実装ガイドライン">実装ガイドライン</a></li>
<li><a href="#10-参考資料">参考資料</a></li>
</ul>

<hr>

<h2>1. はじめに</h2>

<h3>1.1 目的</h3>
<p>
本文書は、株式会社THE WORLD DOORが開発する物流フルフィルメントシステムの技術スタックを定義し、開発チーム全体で共有すべき技術的な指針を示すものです。
</p>

<h3>1.2 対象読者</h3>
<ul>
<li>開発チームメンバー</li>
<li>プロジェクトマネージャー</li>
<li>システムアーキテクト</li>
<li>技術責任者</li>
</ul>

<h3>1.3 文書の更新</h3>
<p>
本文書は、技術の進化や要件の変更に応じて定期的に更新されます。最新版は社内ドキュメント管理システムで管理されます。
</p>

<hr>

<h2>2. システム概要</h2>

<h3>2.1 システム名称</h3>
<p>
<strong>THE WORLD DOOR フルフィルメントシステム</strong>
</p>

<h3>2.2 システムの目的</h3>
<p>
カメラ・高級時計を中心とした高付加価値商品の物流・販売代行サービスを提供し、商品のライフサイクル全体を可視化・管理するWebアプリケーションシステム。
</p>

<h3>2.3 主要機能</h3>
<ul>
<li>商品受入・検品管理</li>
<li>在庫保管・ロケーション管理</li>
<li>商品撮影・出品サービス</li>
<li>受注・出荷フルフィルメント</li>
<li>返品・アフターサービス</li>
<li>請求・決済管理</li>
<li>レポート・分析機能</li>
</ul>

<hr>

<h2>3. 技術選定方針</h2>

<h3>3.1 基本方針</h3>
<ul>
<li><strong>実績と安定性</strong>: 広く採用され、長期的なサポートが見込める技術を優先</li>
<li><strong>開発効率</strong>: 高い生産性を実現するモダンなフレームワークとツールを採用</li>
<li><strong>スケーラビリティ</strong>: 事業成長に対応できる拡張性を確保</li>
<li><strong>保守性</strong>: コードの可読性と保守性を重視した技術選定</li>
</ul>

<h3>3.2 技術統一方針</h3>
<ul>
<li><strong>プログラミング言語</strong>: TypeScriptで統一（フロントエンド・バックエンド共通）</li>
<li><strong>スタイリング</strong>: Tailwind CSSによるユーティリティファーストアプローチ</li>
<li><strong>フレームワーク</strong>: Next.js 14を中心としたReactエコシステム</li>
</ul>

<hr>

<h2>4. フロントエンド技術スタック</h2>

<h3>4.1 コアフレームワーク</h3>

<h4>4.1.1 Next.js 14.2.5 (App Router)</h4>
<p>
<strong>CODE<em>BLOCK</em>0</strong>
</p>

<h4>4.1.2 TypeScript</h4>
<p>
<strong>CODE<em>BLOCK</em>1</strong>
</p>

<h3>4.2 スタイリング</h3>

<h4>4.2.1 Tailwind CSS v3.4.1</h4>
<p>
<strong>CODE<em>BLOCK</em>2</strong>
</p>

<h4>4.2.2 UIコンポーネントライブラリ</h4>
<ul>
<li><strong>@tremor/react 3.18.7</strong>: ダッシュボードコンポーネント</li>
<li><strong>@heroicons/react 2.2.0</strong>: アイコンセット</li>
<li><strong>lucide-react 0.525.0</strong>: 追加アイコンセット</li>
<li><strong>カスタムNexusデザインシステム</strong>: プロジェクト独自のUI統一デザイン</li>
</ul>

<h3>4.3 状態管理</h3>

<h4>4.3.1 グローバル状態管理</h4>
<p>
<strong>CODE<em>BLOCK</em>3</strong>
</p>

<h4>4.3.2 サーバー状態管理</h4>
<ul>
<li><strong>カスタムuseApiフック</strong>: APIデータの取得・キャッシング</li>
<li><strong>Socket.io 4.7.5</strong>: リアルタイム通信</li>
<li><strong>リアルタイム通知システム</strong>: 商品ステータス変更、タスク割り当て通知</li>
</ul>

<h4>4.3.3 フォーム管理</h4>
<ul>
<li><strong>React Hook Form 7.59.0</strong>: 高性能なフォーム管理</li>
<li><strong>Zod 3.25.67</strong>: スキーマベースのバリデーション</li>
<li><strong>@hookform/resolvers 5.1.1</strong>: バリデーション統合</li>
</ul>

<h3>4.4 主要ライブラリ</h3>

<table>
<p>
<thead>
<tr>
<th>カテゴリ</th>
<th>ライブラリ</th>
<th>バージョン</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>グラフ・可視化</td>
<td>Chart.js + react-chartjs-2</td>
<td>4.5.0</td>
<td>KPIダッシュボード</td>
</tr>
<tr>
<td>Recharts</td>
<td>3.0.2</td>
<td>分析チャート</td>
</tr>
<tr>
<td>バーコード</td>
<td>カスタムバーコードシステム</td>
<td>-</td>
<td>バーコード生成・スキャン</td>
</tr>
<tr>
<td>画像処理</td>
<td>next/image</td>
<td>Next.js内蔵</td>
<td>最適化された画像表示</td>
</tr>
<tr>
<td>Sharp</td>
<td>0.34.4</td>
<td>サーバーサイド画像処理</td>
</tr>
<tr>
<td>Jimp</td>
<td>1.6.0</td>
<td>画像操作</td>
</tr>
<tr>
<td>html2canvas</td>
<td>1.4.1</td>
<td>HTML→画像変換</td>
</tr>
<tr>
<td>PDF生成</td>
<td>jsPDF</td>
<td>3.0.1</td>
<td>クライアント側PDF生成</td>
</tr>
<tr>
<td>PDFKit</td>
<td>0.17.1</td>
<td>サーバー側PDF生成</td>
</tr>
<tr>
<td>pdfmake</td>
<td>0.2.20</td>
<td>高度なPDFレイアウト</td>
</tr>
<tr>
<td>動画処理</td>
<td>fluent-ffmpeg</td>
<td>2.1.3</td>
<td>動画エンコード</td>
</tr>
<tr>
<td>Puppeteer</td>
<td>24.12.0</td>
<td>ブラウザ自動化・スクリーンショット</td>
</tr>
<tr>
<td>日付処理</td>
<td>date-fns</td>
<td>4.1.0</td>
<td>軽量な日付ユーティリティ</td>
</tr>
<tr>
<td>アイコン</td>
<td>lucide-react</td>
<td>0.525.0</td>
<td>メインアイコンセット</td>
</tr>
<tr>
<td>@heroicons/react</td>
<td>2.2.0</td>
<td>追加アイコン</td>
</tr>
<tr>
<td>通知</td>
<td>カスタム通知システム</td>
<td>-</td>
<td>リアルタイム通知・トースト</td>
</tr>
<tr>
<td>認証</td>
<td>jsonwebtoken</td>
<td>9.0.2</td>
<td>JWT認証</td>
</tr>
<tr>
<td>bcryptjs</td>
<td>2.4.3</td>
<td>パスワードハッシュ</td>
</tr>
<tr>
<td>テスト</td>
<td>Playwright</td>
<td>1.54.2</td>
<td>E2Eテスト</td>
</tr>
<tr>
<td>Jest</td>
<td>29.7.0</td>
<td>ユニットテスト</td>
</tr>
<tr>
<td>アーカイブ</td>
<td>archiver</td>
<td>7.0.1</td>
<td>ファイル圧縮</td>
</tr>
<tr>
<td>ストレージ</td>
<td>@aws-sdk/client-s3</td>
<td>3.500.0</td>
<td>AWS S3連携</td>
</tr>
<tr>
<td>メール送信</td>
<td>@sendgrid/mail</td>
<td>8.1.3</td>
<td>メール配信</td>
</tr>
</tbody>
</table>
</p>

<h3>4.5 ディレクトリ構造</h3>

<p>
<strong>CODE<em>BLOCK</em>4</strong>
</p>

<hr>

<h2>5. バックエンド技術スタック</h2>

<h3>5.1 API構成</h3>

<h4>5.1.1 Next.js API Routes</h4>
<p>
<strong>CODE<em>BLOCK</em>5</strong>
</p>

<h4>5.1.2 RESTful API設計</h4>
<p>
<strong>CODE<em>BLOCK</em>6</strong>
</p>

<h3>5.2 データベース</h3>

<h4>5.2.1 SQLite（開発環境）/ PostgreSQL 15（本番環境）</h4>
<p>
<strong>CODE<em>BLOCK</em>7</strong>
</p>

<h4>5.2.2 キャッシュ・セッション管理</h4>
<ul>
<li><strong>メモリキャッシュ</strong>: 開発環境でのシンプルなキャッシュ</li>
<li><strong>JWT</strong>: セッション管理</li>
<li><strong>Socket.io</strong>: リアルタイム通知</li>
</ul>

<h3>5.3 外部サービス連携</h3>

<table>
<p>
<thead>
<tr>
<th>サービス</th>
<th>用途</th>
<th>SDK/ライブラリ</th>
<th>実装状況</th>
</tr>
</thead>
<tbody>
<tr>
<td>eBay API</td>
<td>商品出品・受注管理</td>
<td>カスタムアダプター</td>
<td>実装済み</td>
</tr>
<tr>
<td>決済サービス</td>
<td>決済処理</td>
<td>未定</td>
<td>計画中</td>
</tr>
<tr>
<td>メール送信</td>
<td>通知メール</td>
<td>カスタムアダプター</td>
<td>実装済み</td>
</tr>
<tr>
<td>AWS S3</td>
<td>ファイルストレージ</td>
<td>aws-sdk</td>
<td>実装済み</td>
</tr>
<tr>
<td>ヤマト運輸</td>
<td>配送管理</td>
<td>カスタムREST API</td>
<td>実装済み</td>
</tr>
<tr>
<td>佐川急便</td>
<td>配送管理</td>
<td>カスタムREST API</td>
<td>実装済み</td>
</tr>
<tr>
<td>2要素認証</td>
<td>セキュリティ</td>
<td>カスタム実装</td>
<td>実装済み</td>
</tr>
</tbody>
</table>
</p>

<h3>5.4 実装済み機能</h3>

<h4>5.4.1 商品管理機能</h4>
<ul>
<li>商品登録・編集・削除</li>
<li>ステータス管理（inbound→inspection→storage→listing→ordered→picking→packed→label<em>attached→shipment</em>requested→shipped→delivered）</li>
<li>バーコードによる商品検索・スキャン</li>
<li>商品履歴追跡（Activity History）</li>
<li>シリアルナンバー管理</li>
<li>メタデータ（JSON形式）保存</li>
</ul>

<h4>5.4.2 在庫管理機能</h4>
<ul>
<li>ロケーション管理（Zone-Row-Shelf形式）</li>
<li>ロケーション移動履歴（InventoryMovement）</li>
<li>在庫ステータス別フィルタリング</li>
<li>バーコードスキャナー連携</li>
<li>在庫一覧・検索機能</li>
</ul>

<h4>5.4.3 検品・品質管理</h4>
<ul>
<li>階層的検品チェックリスト（HierarchicalInspectionChecklist）</li>
<li>カテゴリ別検品項目（inspection-items.ts）</li>
<li>画像アップロード・管理（ProductImage）</li>
<li>動画記録機能（VideoRecord）</li>
<li>検品履歴・メモ管理</li>
<li>商品状態評価</li>
</ul>

<h4>5.4.4 出品・販売管理</h4>
<ul>
<li>eBay連携による自動出品（ebay.adapter.ts）</li>
<li>出品テンプレート管理（ebay-listing-templates.ts）</li>
<li>出品適格性チェック（listing-eligibility.ts）</li>
<li>価格管理（購入価格・販売価格）</li>
<li>出品履歴追跡（Listing）</li>
</ul>

<h4>5.4.5 配送・物流管理</h4>
<ul>
<li>納品プラン作成（DeliveryPlan）</li>
<li>配送倉庫管理（delivery-warehouses API）</li>
<li>FedEx連携（fedex.adapter.ts）</li>
<li>複数配送業者対応</li>
<li>配送ラベル生成・印刷</li>
<li>梱包処理（Packaging）</li>
<li>ピッキング処理（Picking）</li>
<li>配送追跡</li>
</ul>

<h4>5.4.6 スタッフ管理・認証</h4>
<ul>
<li>ロールベースアクセス制御（seller/staff/admin）</li>
<li>2要素認証（TwoFactorAuth）</li>
<li>JWT認証システム</li>
<li>タスク管理（Task）</li>
<li>スタッフダッシュボード</li>
<li>アクティビティログ記録</li>
</ul>

<h4>5.4.7 通知・分析機能</h4>
<ul>
<li>リアルタイム通知システム（Socket.io）</li>
<li>メール通知（SendGrid）</li>
<li>アクティビティログ（Activity）</li>
<li>分析・レポート機能（Analytics API）</li>
<li>KPIダッシュボード</li>
</ul>

<h4>5.4.8 その他機能</h4>
<ul>
<li>機能フラグ管理（Feature Flags）</li>
<li>マスタデータ管理（Master API）</li>
<li>PDF帳票生成</li>
<li>画像処理・リサイズ</li>
<li>返品処理（Returns）</li>
<li>バンドル販売対応</li>
</ul>

<hr>

<h2>6. インフラストラクチャ</h2>

<h3>6.1 ホスティング構成</h3>

<h4>6.1.1 Vercel（フロントエンド）</h4>
<p>
<strong>CODE<em>BLOCK</em>8</strong>
</p>

<h4>6.1.2 AWS（バックエンドサービス）</h4>
<p>
<strong>CODE<em>BLOCK</em>9</strong>
</p>

<h3>6.2 CI/CD パイプライン</h3>

<p>
<strong>CODE<em>BLOCK</em>10</strong>
</p>

<h3>6.3 監視・ログ管理</h3>

<table>
<p>
<thead>
<tr>
<th>カテゴリ</th>
<th>ツール</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>APM</td>
<td>Vercel Analytics</td>
<td>Web Vitals監視</td>
</tr>
<tr>
<td>エラー追跡</td>
<td>Sentry</td>
<td>リアルタイムエラー検知</td>
</tr>
<tr>
<td>ログ管理</td>
<td>AWS CloudWatch</td>
<td>アプリケーションログ</td>
</tr>
<tr>
<td>死活監視</td>
<td>Uptime Robot</td>
<td>エンドポイント監視</td>
</tr>
<tr>
<td>セッション分析</td>
<td>LogRocket</td>
<td>ユーザー行動分析</td>
</tr>
</tbody>
</table>
</p>

<hr>

<h2>7. 開発環境</h2>

<h3>7.1 必要なツール</h3>

<p>
<strong>CODE<em>BLOCK</em>11</strong>
</p>

<h3>7.2 開発環境セットアップ</h3>

<p>
<strong>CODE<em>BLOCK</em>12</strong>
</p>

<h3>7.3 コーディング規約</h3>

<h4>7.3.1 ESLint設定</h4>
<p>
<strong>CODE<em>BLOCK</em>13</strong>
</p>

<h4>7.3.2 Prettier設定</h4>
<p>
<strong>CODE<em>BLOCK</em>14</strong>
</p>

<hr>

<h2>8. セキュリティ要件</h2>

<h3>8.1 認証・認可</h3>

<h4>8.1.1 JWT認証設定</h4>
<p>
<strong>CODE<em>BLOCK</em>15</strong>
</p>

<h3>8.2 セキュリティヘッダー</h3>

<p>
<strong>CODE<em>BLOCK</em>16</strong>
</p>

<h3>8.3 データ保護</h3>

<ul>
<li><strong>転送時</strong>: HTTPS通信による暗号化</li>
<li><strong>保存時</strong>: パスワードのbcryptハッシュ化</li>
<li><strong>機密情報</strong>: 環境変数による管理</li>
<li><strong>2要素認証</strong>: メールベースの確認コード</li>
<li><strong>セッション管理</strong>: JWT + HTTPOnly Cookie</li>
</ul>

<hr>

<h2>9. 実装ガイドライン</h2>

<h3>9.1 コンポーネント設計原則</h3>

<h4>9.1.1 コンポーネントの分類</h4>
<p>
<strong>CODE<em>BLOCK</em>17</strong>
</p>

<h4>9.1.2 フィーチャーコンポーネント</h4>
<p>
<strong>CODE<em>BLOCK</em>18</strong>
</p>

<h3>9.2 パフォーマンス最適化</h3>

<h4>9.2.1 画像最適化</h4>
<p>
<strong>CODE<em>BLOCK</em>19</strong>
</p>

<h4>9.2.2 動的インポート</h4>
<p>
<strong>CODE<em>BLOCK</em>20</strong>
</p>

<h3>9.3 テスト戦略</h3>

<h4>9.3.1 単体テスト</h4>
<p>
<strong>CODE<em>BLOCK</em>21</strong>
</p>

<h4>9.3.2 E2Eテスト</h4>
<p>
<strong>CODE<em>BLOCK</em>22</strong>
</p>

<hr>

<h2>10. 参考資料</h2>

<h3>10.1 技術ドキュメント</h3>
<ul>
<li><a href="https://nextjs.org/docs">Next.js Documentation</a></li>
<li><a href="https://tailwindcss.com/docs">Tailwind CSS Documentation</a></li>
<li><a href="https://www.typescriptlang.org/docs/">TypeScript Handbook</a></li>
<li><a href="https://www.prisma.io/docs/">Prisma Documentation</a></li>
<li><a href="https://tanstack.com/query/latest">React Query Documentation</a></li>
</ul>

<h3>10.2 社内リソース</h3>
<ul>
<li>アーキテクチャ設計書: <code>docs/architecture.md</code></li>
<li>API仕様書: <code>docs/api-specification.md</code></li>
<li>デプロイメントガイド: <code>docs/deployment-guide.md</code></li>
<li>トラブルシューティング: <code>docs/troubleshooting.md</code></li>
</ul>

<h3>10.3 お問い合わせ</h3>
<p>
技術的な質問や提案については、以下にお問い合わせください：
</p>
<ul>
<li>技術責任者: tech-lead@the-world-door.com</li>
<li>開発チームSlack: #dev-fulfillment-system</li>
</ul>

<hr>

<p>
<strong>改訂履歴</strong>
</p>

<table>
<p>
<thead>
<tr>
<th>バージョン</th>
<th>日付</th>
<th>変更内容</th>
<th>承認者</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>2024-06-21</td>
<td>初版作成</td>
<td>CTO</td>
</tr>
<tr>
<td>2.0</td>
<td>2025-01-13</td>
<td>実装状況に合わせて全面更新</td>
<td>CTO</td>
</tr>
<tr>
<td>3.0</td>
<td>2025-10-03</td>
<td>最新の実装状況を反映（API40エンドポイント、詳細機能追加）</td>
<td>CTO</td>
</tr>
</tbody>
</table>
</p>

<hr>

<p>
本文書は株式会社THE WORLD DOORの機密情報です。無断での複製・配布を禁じます。
</p>

<p>
© 2024 THE WORLD DOOR Inc. All rights reserved.
</p>
    </div>
</body>
</html>